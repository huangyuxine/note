# 常见安全问题

## 浏览器安全 <a href="#liu-lan-qi-an-quan" id="liu-lan-qi-an-quan"></a>

### 同源策略

域名+协议+端口，其中一个不同就视为不同源，用来限制不同源的脚本，对当前文档读取或者设置某些属性

### 恶意网址

常见的恶意网址：一类是挂马网站，这些网站通常包含恶意的脚本，例如javascript，利用浏览器漏洞在用户电脑上植入木马；另一类是钓鱼网站，通过模仿知名网站的相似网页来欺骗用户。

防御：https证书和黑名单拦截

### HTTP协议

## XSS跨站脚本攻击

Cross Site Script，通过HTML或者javascript注入篡改网页，插入恶意脚本，从而在用户浏览网页时，控制用户浏览器的一种攻击。

### 反射型XSS

反射型xss只是简单的把用户输入的数据反射给浏览器，往往需要诱使用户点击一个恶意链接才能攻击成功。反射型xss也叫做非持久型xss。

### 存储型XSS

存储型XSS会把用户输入的数据存储在服务器端，比如黑客写了一篇包含恶意的javascript代码的博客文章，文章发表后，所有访问该博客文章的用户，都会在他们浏览器中执行这段代码。

### 基于DOM的XSS

这种类型并非按照数据是否存储在服务器端来划分，和反射型类似，客户端的脚本程序可以动态地检查和修改页面内容，而不依赖于服务器端的数据，例如客户端如从 URL 中提取数据并在本地执行

防御：对用户输入的内容进行转译，比如PHP中的htmlspecialchars

## CSRF跨站请求伪造

防御：必要的页面加token去校验合法请求

## WEB应用安全

### SQL注入

攻击者将改变原来的语句，对数据库表进行删除或其他操作。

防御：严格限制用户的输入，校验数据类型；使用预编译语句；最小权限原则，避免使用root；

### 文件上传漏洞

防御：文件上传的目录设置为不可执行；判断文件类型；使用随机数改写文件名；单独设置文件服务器；

### 认证与会话管理

#### 弱密码

防御：使用不可逆的加密算法；密码复杂度；

#### 多因素认证

密码/邮箱/手机号/实名

#### session文件过多

redis存储

### 加密算法

使用cbc模式的aes256用于加密；使用HMAC-SHA512用于完整性检查；使用salt的SHA-256或SHA-512用于加密

### 网络层DDOS

分布式拒绝服务，利用合理的请求造成资源过载，导致服务不可用。

syn flood、udp flood、icmp flood

syn flood 利用tcp设计中的缺陷，伪造大量的源ip地址，分别向服务器发送大量的SYN包，此时服务器会返回SYN/ACK的包，因为源地址是伪造的，所以伪造的ip并不会应答，服务器端没有收到伪造ip的回应，会重试3-5次并等待一个syn time（一般为30s-120s)，如果超时则会丢弃这个连接。攻击者大量发送这种伪造源地址的SYN请求，服务器端会消耗非常多的资源(cpu和内存)来处理这种半连接，同时还要不断的对这些ip进行syn和ack重试。最后服务器无暇理睬正常的连接请求，导致拒绝服务。

### 应用层DDOS

发起攻击的ip地址都是真实的，是针对服务器性能的一种攻击。比如爬虫。

防御：针对每个客户端做一个请求频率限制。架构优化。性能优化。

## php安全

include,require,include\_once,require\_once包含一个新文件时，该文件会作为php代码执行，PHP内核并不会在意该被包含的文件是什么类型

#### 安全配置

expose\_php = Off 隐藏php在header头中的版本

open\_basedir 使用open\_basedir选项能够控制PHP脚本只能访问指定的目录，这样能够避免PHP脚本访问不应该访问的文件，一定程度上限制了phpshell的危害，我们一般可以设置为只能访问网站目录

display\_errors = Off 关闭错误信息

disable\_functions 禁用不安全的函数chdir,chroot,dir,getcwd,opendir,readdir,scandir,fopen,unlink,delete,copy,mkdir,rmdir,rename,file,file\_get\_contents,fputs,fwrite,chgrp,chmod,chown
